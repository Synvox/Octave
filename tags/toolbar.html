<toolbar>
  <div class="inner">
    <div class="left">
      <svg viewBox="0 0 24 24" onclick={ playPrev }>
        <path d="M11.5,12L20,18V6M11,18V6L2.5,12L11,18Z" />
      </svg>
      <svg viewBox="0 0 24 24" onclick={ playPause }>
        <path if={ playing } d="M14,19.14H18V5.14H14M6,19.14H10V5.14H6V19.14Z" />
        <path if={ !playing }  d="M8,5.14V19.14L19,12.14L8,5.14Z" />
      </svg>
      <svg viewBox="0 0 24 24" onclick={ playNext }>
        <path d="M13,6V18L21.5,12M4,18L12.5,12L4,6V18Z" />
      </svg>
    </div>
    <div class="center">
      <span class="time-left">{time.left}</span>
      <span class="time-right">{time.right}</span>
      <div id="waveform"></div>
    </div>
    <div class="right">
      <form onsubmit={ search } class="search">
        <input type="submit" hidden>
        <input onkeyup={ search } class="query">
        <svg viewBox="0 0 24 24" class="exit" if={ hasQuery } onclick={ resetSearch }>
          <path d="M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V5H19V19M17,8.4L13.4,12L17,15.6L15.6,17L12,13.4L8.4,17L7,15.6L10.6,12L7,8.4L8.4,7L12,10.6L15.6,7L17,8.4Z" />
        </svg>
      </form>
    </div>
  </div>
  <crumbs></crumbs>
  <style type="less">
    toolbar {
      display: block;
      height: 110px;
      position: fixed;
      left: 0px;
      right: 0px;
      top: 0px;
      background: white;
      box-shadow: 0px 0px 2px rgba(0,0,0,.3),
                  0px 0px 16px rgba(0,0,0,.1);
      overflow: hidden;
      z-index: 10;
      .inner {
        position: absolute;
        top: 60px;
        height: 50px;
        left: 0px;
        right: 0px;
        overflow: hidden;
        z-index: 10;
      }
      crumbs {
        position: absolute;
        left: 0;
        right: 0;
        height: 60px;
        top: 0px;
        z-index: 9;
      }
      .left {
        padding: 4px 0px;
        width: 25vw;
        text-align: center;
        position: absolute;
        top: 0px;
        left: 0px;
        bottom: 0px;
        z-index: 10;
        -webkit-user-select: none;
        box-shadow: 0px 0px 2px rgba(0,0,0,.3),
                    0px 0px 16px rgba(0,0,0,.1);
        svg {
          width: 40px;
          path {
            fill: #555;
          }
          &:active path {
            fill: #000;
          }
        }
      }
      .center {
        text-align: center;
        position: absolute;
        top: 0px;
        right: 25vw;
        left: 25vw;
        bottom: 0px;
        z-index: 9;
        border-left: 1px solid #ccc;
        border-right: 1px solid #ccc;
        background: rgba(0,0,0,.03);
        #waveform {
          position: absolute;
          left: 0px;
          right: 0px;
          bottom: 0px;
          top: 0px;
        }
        canvas {
          width: 100%;
        }
        .time-left {
          position: absolute;
          left: 0px
          top: 8px;
        }
        .time-right {
          position: absolute;
          right: 0px
          top: 8px;
        }
      }
      .right {
        width: 25vw;
        text-align: center;
        position: absolute;
        top: 0px;
        right: 0px;
        bottom: 0px;
        z-index: 10;
        box-shadow: 0px 0px 2px rgba(0,0,0,.3),
                    0px 0px 16px rgba(0,0,0,.1);
        form.search {
          border: 1px solid #ccc;
          border-radius: 3px;
          position: absolute;
          top: 10px;
          right: 10px;
          bottom: 10px;
          height: 30px;
          width: ~"calc(100% - 22px)";

          input.query {
            position: absolute;
            left: 0px;
            top: 0px;
            bottom: 0px;
            border: none;
            padding: 0px 12px;
            width: ~"calc(100% - 30px)";
            &:focus {
              outline: none;
            }
          }
          .exit {
            position: absolute;
            right: 5px;
            top: 5px;
            height: 18px;
            cursor: pointer;
            path {
              fill: #444;
            }
            &:active path {
              fill: #000;
            }
          }
        }
      }
    }
  </style>
  <script>
    var self = this;
    self.playing = false;

    self.playPause = function(){
      App.trigger('play_pause')
    }

    self.playNext = function(){
      App.trigger('play_next')
    }

    self.playPrev = function(){
      App.trigger('play_prev')
    }

    App.on('track_playing',function(){
      self.update({playing: true})
    })

    App.on('track_pausing',function(){
      self.update({playing: false})
    })

    // function timeToString(time) {
    //   var min, sec;
    //   min = Math.floor(time / 60)
    //   sec = time - min * 60
    //
    //   return min + ':' + sec
    // }
    //
    // App.on('track_time_update',function(cur,total){
    //   self.update({time:
    //     {
    //       left: timeToString(cur),
    //       right: timeToString(total)
    //     }
    //   });
    // })

    var timeout = null;
    self.search =  function(){
      var query = $(self.root).find('input.query').val()

      if (timeout)
        window.clearTimeout(timeout)

      timeout = window.setTimeout(function(){
        App.trigger('filter_tracks_by',query)
      },100)
    }

    self.resetSearch = function(){
      App.trigger('filter_tracks_by','')
    }

    self.hasQuery = false;
    App.on('filter_tracks_by',function(query){
      var input = $(self.root).find('input.query')

      if (!input.is(":focus")) {
        input.val(query);
      }

      self.hasQuery = !!(query.length);
      self.update();
    })
  </script>
</toolbar>
