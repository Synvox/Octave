<track onclick={ select }>
  <div class="cell">{ data.name }</div>
  <div class="cell">{ data.album }</div>
  <div class="cell">{ data.artist }</div>

  <style type="less">
    track {
      cursor: pointer;
      overflow: hidden;
      color: #000;
      display: block;
      width: 100%;

      &:nth-child(even) {
        background: rgba(0,0,0,.01);
      }
      &:hover {
        color: black;
        background: rgba(0,0,0,.1);
      }
      &.active {
        color: #fff;
        background: #FF8D00;
        text-shadow: 0px 1px 1px darken(#FF8D00,5%);
        box-shadow: 0px -.5px 0px 1px darken(#FF8D00,5%) inset;
      }
      .cell {
        overflow: hidden;
        text-overflow: ellipsis;
        overflow: hidden;
      }
    }
  </style>
  <script>
    var self = this
    self.data = self.opts.data
    self.index = self.opts.index
    // self.time = new Date(self.data['Total Time'])
    // self.timeStr = self.time.getMinutes() + ':' + ((self.time.getSeconds()<10)? '0':'') + self.time.getSeconds()

    var $r = $(self.root)

    self.active = false
    self.select = ()=>{
      if (self.active) return

      App.trigger('select_track',self.index)
    }

    App.on('select_track',function(index){
      if (index !== self.index) return;

      self.active = true
      $r.addClass('active')

      App.one('select_track',function(){
        self.active = false
        $r.removeClass('active')
        $r.find('.progress .value').css({'width':'0%'})
        App.off('track_time_update',self.updateTime)
        self.update()
      })

      App.on('track_time_update',self.updateTime)

      self.update()
    })

    self.updateTime = (time,duration)=>{
      var min = Math.floor(time / 60)
      var sec = Math.floor(time - min*60)
      self.currentTimeStr = min + ':' + ((sec < 10)?'0':'') + sec

      min = Math.floor(duration / 60)
      sec = Math.floor(duration - min*60)
      self.timeStr = min + ':' + ((sec < 10)?'0':'') + sec

      self.update()

      var percent = (time / duration)*100
      $r.find('.progress .value').css({'transform':'translateX(-'+(100-percent)+'%)'})
    }

    self.playPause = ()=>{
      $r.find('.circle').toggleClass('playing')
      window.setTimeout(()=>{
        App.trigger('play_pause')
      },1)

    }

  </script>
</track>
